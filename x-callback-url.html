<!DOCTYPE html>
<!--[if lt IE 7 ]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]>    <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]>    <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>x-callback-url in Working Copy</title>
<meta name="author" content="Anders Borum">
<meta name="keywords" content="iOS,git,repository,programming,automation,workflow,x-callback-url">
<link rel="stylesheet" type="text/css" href="css/2014.css">
<meta name="apple-itunes-app" content="app-id=896694807" affiliate-data="at=1000lHq">

<style>

h1 {
    font-size: 125%;
}

h2 {
    font-size: 110%;
}

body {
    font-size: 20px;
}

p {
    margin-bottom: 0px;
    max-width: 800px;
}

pre {
    font-size: 70%;
    word-wrap: break-word;
    margin-top: 5px;
    padding: 4px;
    max-width: 100%;
    color: #000000;
    background-color: #ecf0f3;
    display: inline-block;
}

img {
    float: right;
    width: 200px;
    max-width: 50%;
    height: auto;
    margin-left: 10px;
}

img.anim {
    width: 140px;
}

footer {
    font-size: 70%;
    padding-bottom: 20px;
}

</style>
</head><body>
<div>
    <header>
        <h1 itemprop="name">Controlling Working Copy with x-callback-url</h1>
        
        <p>
         To allow automated workflows <a href="/">Working Copy</a> can be controlled
         through <a href="http://x-callback-url.com/">x-callback-url</a>.
        </p>
    </header>
    
    <h2>URL format</h2>
    <p>The url-scheme is <em>working-copy</em> such that all URLs must have the form:</p>
    <pre> working-copy://x-callback-url/&lt;command&gt;/?x-success=&lt;escaped-url&gt;&amp;repo=...&amp;key=...</pre>
    <p>If you include a <em>x-error</em> parameter it will be used to deliver errors, otherwise errors are shown inside Working Copy.
    Including <em>x-success</em> is also optional but commands without side-effects will not say anything inside Working Copy on success.
    </p>
    <p> <img src="img/callback-settings.png" alt="Screenshot with URL callback settings including key." />
        Because the commands allow reading and writing your sourcecode, they are protected by a <em>key</em> parameter
       which must match a random alphanumeric code created when you first launch Working Copy on a new device. You can
       edit this key inside settings to get the same code for all your devices making it easier to reuse scripts, but you
       should make sure never to use a <em>key</em> value you found in some public script, as this would be equivalent to
       sharing a password with everyone else. </p>
       
       <p>To avoid very long examples the <em>key</em> parameter will not be included in every example here,
        but it IS required for every command. To avoid brute-force attempts at guessing the <em>key</em>, Working Copy
        will show errors related to <em>key</em> inside the app, but will not be calling <em>x-error</em>.
       </p>
    <p>All commands requires the <em>repo</em> parameter that specifies which repository the command is about.
     This can either be the name of the repository as seen in the list of repositories in the outermost view of the app or the full
     remote url of the repository. Remember to url-encode <em>repo</em> just like all other parameters. Space needs to be percent-
     rather than plus-encoded.</p>

    <h2>Writing files</h2>
    <p><img src="img/my-repo.png" alt="Screenshot showing README.md as only file in 'my repo'" />
    Write to existing or new files with the <em>write</em> command. If you include a <em>text</em> parameter this will
    be the content written to the file at the given <em>path</em>.</p>
    <pre> working-copy://x-callback-url/write/?key=123ABC&amp;repo=my%20repo&amp;path=README.md&amp;text=hello%20there </pre>
    <p>Include the parameter <em>append=1</em> to append the <em>text</em> or pasteboard content to
        the existing file. The <em>path</em> is relative to repository and must <em>not</em> start with /.</p>
    <p>If you need to write images or other binary files you can transfer the content as <a href="http://en.wikipedia.org/wiki/Base64">base-64</a>
       by using the parameter <em>base64=</em> instead of <em>text=</em>. You need to URL-encode after base-64
       encoding since the characters <em>+</em> and <em>/</em> occur after base-64 coding.</p>
    <p>If you do not include either a <em>text</em> or <em>base64</em> parameter the pasteboard content is written.</p>

    <h2 id="reading">Reading files</h2>
    <p>You can get the contents of text files with the <em>read</em> command and result will be URL-encoded and appended to
       the x-success callback.</p>
       <pre>working-copy://x-callback-url/read/?x-success=my-app://x-callback-url/read?t=/&amp;repo=my%20repo&amp;path=README.md </pre>
       <p>will make Working Copy open a url on the form:</p>
       <pre> my-app://x-callback-url/read?t=hello%20there</pre>
       <p>It should be noted that in order to support different apps that want to read text differently and might not
          follow the x-callback-url conventions (<a href="http://omz-software.com/pythonista/docs/ios/urlscheme.html">Pythonista</a>
           being the prime example),
           you should include the parameter name at the end of <em>x-success</em>
          as in this <a href="#textastic-example">Textastic example</a>. Working Copy tries to be smart about appending
       the file content as <em>&amp;text=...</em> if it detects a <em>x-callback-url</em> that would become malformed,
       but your best bet is to format <em>x-success</em> manually.</p>
       <p>If you are reading a binary file the result will be transferred as
          <a href="http://en.wikipedia.org/wiki/Base64">base-64</a> and if Working Copy appends the
          parameter name it will be <em>&amp;base64=...</em> but to ensure the file content is returned
          in base64 coding you include the input parameter <em>base64=1</em>.</p>
          <pre>working-copy://x-callback-url/read/?x-success=...&amp;repo=my%20repo&amp;path=README.md&amp;base64=1 </pre>
    <p>
    
    <h2 id="committing">Committing changes</h2>
    <p>
      The <em>commit</em> command can be used on single files, directories or the entire repository. You use the <em>path</em>
      parameter to specify the files to take into account, where a missing or empty parameter means the entire repository is
      checked for modified files to commit. </p>
      <p>To avoid accidentally committing unexpected changes the <em>limit</em> parameter is
      checked and if there are more changed files covered by <em>path</em> than allowed by <em>limit</em> the commit fails.
      The default is <em>limit=1</em> but you can set it to large values if you intentionally want to commit
      all changes files.</p>
      <p>You need to supply a <em>message</em> parameter for the commit message and formatting/wrapping
      this <em>message</em> in accordance with <a href="http://git-scm.com/book/ch5-2.html#_commit_guidelines">best practices</a>
      is your responsibility.
      <pre> working-copy://x-callback-url/commit/?repo=my%20repo&amp;path=&amp;limit=999&amp;message=fix </pre>
    </p>

    <h2>Push to remote</h2>
    <p>Use the <em>push</em> command to send commits back to the origin remote. If you need to authenticate, the
    push command will wait until you have entered your credentials. You can push to other remotes than origin by
     using the <em>remote</em> paramater.</p>
    <pre> working-copy://x-callback-url/push/?repo=my%20repo </pre>

    <h2>Pull from remote</h2>
     <p>The <em>pull</em> command fetches and merges changes from your origin remote. If you need to authenticate, the
     pull command will wait until you have entered your credentials. Any merge conflicts will count as a error.</p>
      <pre> working-copy://x-callback-url/pull/?repo=my%20repo</pre>
      <p>Just like the <em>push</em> command you can use the <em>remote</em> parameter to pull from
      non-origin remotes.</p>

<!-- Merge is not yet supported 
	<h2 id="merge">Merge file</h2>
    <p>Sometimes you have content inside Working Copy as well as in a editing app. Edits could have been performed
	in the other app, but there might also be changes to the file in Working Copy. You can merge the content from
	the editing app and Working Copy using the <em>merge</em> command. </p>
	
	<p>Just like with the <em>write</em> command
	you use the <em>text</em> parameter to indicate the content you want written and the <em>path</em> parameter
	for which file to write to. Instead of just writing the <em>text</em> this is combined with the current changes
	for the file in the repository. The result from the merge is written to the file and returned in <em>x-success</em>
	just as for the <em>read</em> command. If the file was not modified before the <em>merge</em> command the
	text written will be identical to using <em>write</em> and if the changes to the file at <em>path</em> always
	come from the same source, the merging will end up just writing. But it is safer to use <em>merge</em> since
	changes to the file will flow both in and out of Working Copy and merge conflicts will require user assistance. </p>
	<p>
		Binary files are supported by using the parameter <em>base64</em> to transfer content instead of <em>text</em>.
	</p>
-->    

    <h2>Chaining callbacks</h2>
    <p><img class="anim" src="img/textastic-new.gif" alt="Link is clicked that opens Working Copy and then sends file contents into Textastic to create new file." />
        URL callbacks can get pretty complicated when you want to send the result of one callback along to
       another URL callback. </p>
    
    <p id="textastic-example">
        To create a new text file in <a href="http://www.textasticapp.com/v4/manual/x-callback-url.html">Textastic</a>
        with the filename "two words.txt" you would use the following URL:</p>
    <pre>textastic://x-callback-url/new?name=two%20words.txt&amp;text=hello%20there</pre>
    <p>
     If you wanted to create this file with content from the file <em>README.md</em> in the repository <em>my repo</em>
     you would need to URL escape the callback to Textastic which gives rise to double-encoding of parameters passed
     along.<br/> <em style="font-size: small">space → %20 → %2520</em></p>
     <pre>working-copy://x-callback-url/read/?repo=my%20repo&amp;path=README.md&amp;x-success=textastic%3A%2F%2Fx-callback-url%2Fnew%3Fname%3Dtwo%2520words.txt%26text%3D</pre>
    
    <p id="mailto-example">You could also start a new email with the contents of this file, by making <em>x-success</em>
       use the <em>mailto:</em> scheme with something like
       <pre>working-copy://x-callback-url/read/?repo=my%20repo&amp;path=README.md&amp;x-success=mailto%3A%3Fbody%3D</pre>
       

</div>
<div style="clear: both"> </div>
<footer>
    Read the <a href="working_copy-users_manual.pdf" target="manual">manual</a> and get
    in touch by <a href="/enable-js.html" id="email" title="email">email</a> or on <a href="http://twitter.com/palmin" target="twitter">Twitter</a>.
</footer>
<!--[if lt IE 7 ]>
<script src="/js/dd_belatedpng.js"></script>
<script>DD_belatedPNG.fix('img, .png_bg'); // Fix any <img> or .png_bg bg-images. Also, please read goo.gl/mZiyb</script>
<![endif]-->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script>
    function rev(s) { return s.length <= 1 ? s : rev(s.substr(1)) + s.substr(0,1); }

    $(document).ready(function () {
        var email = document.getElementById("email");
        email.href = "mailto:" + rev("moc.ppaypocgnikrow@sredna"); 
    });
</script>
</body>
</html>